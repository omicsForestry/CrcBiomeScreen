test_that("EvaluateModel works correctly", {
  # Load the CrcBiomeScreenObject
  # CrcBiomeScreenObject <- readRDS("CrcBiomeScreenObject.rds")
  result_RF <- readRDS("result_RF.rds")
  result_XGBoost <- readRDS("result_XGBoost.rds")

  # Define parameters
  model_type <- c("RF", "XGBoost")
  TaskName <- "TestEvaluation"
  TrueLabel <- "CRC"
  PlotAUC <- TRUE

  # Call the EvaluateModel function for RF
  result_RF <- EvaluateModel(
    CrcBiomeScreenObject = result_RF,
    model_type = model_type[1],
    TaskName = TaskName,
    TrueLabel = TrueLabel,
    PlotAUC = PlotAUC
  )

  # Call the EvaluateModel function for XGBoost
  result_XGBoost <- EvaluateModel(
    CrcBiomeScreenObject = result_XGBoost,
    model_type = model_type[2],
    TaskName = TaskName,
    TrueLabel = TrueLabel,
    PlotAUC = PlotAUC
  )

  # Check if the result is not NULL and contains expected elements
  expect_true(!is.null(result_RF))
  expect_true(!is.null(result_XGBoost))
  expect_true("EvaluateResult" %in% names(result_RF))
  expect_true("EvaluateResult" %in% names(result_XGBoost))

  saveRDS(result_RF, "result_RF_evaluated.rds")
  saveRDS(result_XGBoost, "result_XGBoost_evaluated.rds")

  # ================================================================

  result_RF_noweights <- readRDS("result_RF_noweights.rds")
  result_XGBoost_noweights <- readRDS("result_XGBoost_noweights.rds")

  # Define parameters
  model_type <- c("RF", "XGBoost")
  TaskName <- "TestEvaluation_noweights"
  TrueLabel <- "CRC"
  PlotAUC <- TRUE

  # Call the EvaluateModel function for RF
  result_RF_noweights <- EvaluateModel(
    CrcBiomeScreenObject = result_RF_noweights,
    model_type = model_type[1],
    TaskName = TaskName,
    TrueLabel = TrueLabel,
    PlotAUC = PlotAUC
  )

  # Call the EvaluateModel function for XGBoost
  result_XGBoost_noweights <- EvaluateModel(
    CrcBiomeScreenObject = result_XGBoost_noweights,
    model_type = model_type[2],
    TaskName = TaskName,
    TrueLabel = TrueLabel,
    PlotAUC = PlotAUC
  )

  # Check if the result is not NULL and contains expected elements
  expect_true(!is.null(result_RF_noweights))
  expect_true(!is.null(result_XGBoost_noweights))
  expect_true("EvaluateResult" %in% names(result_RF_noweights))
  expect_true("EvaluateResult" %in% names(result_XGBoost_noweights))

  saveRDS(result_RF_noweights, "result_RF_noweights_evaluated.rds")
  saveRDS(result_XGBoost_noweights, "result_XGBoost_noweights_evaluated.rds")
})
