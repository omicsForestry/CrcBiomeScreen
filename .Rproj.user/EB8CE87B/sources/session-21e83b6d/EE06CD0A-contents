#' Normalise the absolute data to relative data by using Total sum scaling
#'  and Geometric Mean of Pairwise Ratios (GMPR)
#'
#' @param CrcBiomeScreenObject From the CreateCrcBiomeScreenObject()
#' @param method TSS or GMPR
#'
#' @importFrom tibble tibble
#'
#' @return CrcBiomeScreenObject$NormalizedData
#' @export
#'
#' @examples CrcBiomeScreenObject <- NormalizeData(CrcBiomeScreenObject,
#'                                                 method = "GMPR",
#'                                                 TaskName = "Normalize_ToyData")
#'           attributes(CrcBiomeScreenObject$NormalizedData)
#'
NormalizeData <- function(CrcBiomeScreenObject = NULL,
                          method = NULL) {
  Data <- CrcBiomeScreenObject$GenusLevelData
  if (method == "TSS") {
    # Transforming into relative abundance
    Data <- as.data.frame(t(normalize(t(Data), method = "TSS")))
  } else if (method == "GMPR") {
    size.factor <- GMPR(t(Data))
    size.factor[is.na(size.factor)] <- mean(size.factor, na.rm = TRUE)
    Data <- Data / size.factor
  }

  CrcBiomeScreenObject$NormalizedData <- Data
  # Add the normalization method to the Data
  attr(CrcBiomeScreenObject$NormalizedData, "NormalizationMethod") <- method
  attr(CrcBiomeScreenObject$NormalizedData, "Timestamp") <- Sys.time()

  return(CrcBiomeScreenObject)
}
